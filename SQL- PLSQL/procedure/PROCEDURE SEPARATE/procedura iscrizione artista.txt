-- PROCEDURA 2: 
-- la procedura sotto implementata viene effettuata da un membro dello staff e permette di iscrivere un nuovo artista

       

CREATE OR REPLACE PROCEDURE ISCRIZIONE_ARTISTA (	
						NOME_NUOVA_PERSONA IN VARCHAR,
					            	COGNOME_NUOVO_ARTISTA IN VARCHAR,
						SESSO IN CHAR,
						CODICE_FISCALE_NUOVO_ARTISTA IN CHAR,
						DATA_DI_NASCITA_NUOVA_PERSONA IN DATE,
 					              	ID_CANZONE_NUOVO_ARTISTA IN NUMBER,
					            	TITOLO_NUOVA_CANZONE IN VARCHAR,
					           	GENERE_NUOVA_CANZONE IN VARCHAR,
					           	MINUTI_NUOVA_CANZONE IN NUMBER,
					          	SECONDI_NUOVA_CANZONE IN NUMBER,
						PASS_NUOVO_ARTISTA IN number,
					          	NUOVO_MUSICISTA IN CHAR,
						TIPO_STRUMENTO IN VARCHAR,
						NOME_BAND IN VARCHAR,
						NUMERO_COMPONENTI IN NUMBER,
						E_SOLISTA NUMBER,
						E_BAND NUMBER)
								IS
									NUMERO_ARTISTI NUMBER(2,0);
									POSTI_DISPONIBILI NUMBER(2,0);
									ERRORE EXCEPTION;

BEGIN
SELECT COUNT(*) INTO NUMERO_ARTISTI FROM PERSONA JOIN ARTISTA ON CODICE_FISCALE_PERSONA=CODICE_FISCALE_ARTISTA;

DBMS_OUTPUT.PUT_LINE(' IL NUMERO DI ARTISTI GIA ISCRITTI E '|| NUMERO_ARTISTI);
POSTI_DISPONIBILI:=(20 - NUMERO_ARTISTI);
IF (NUMERO_ARTISTI<20) THEN
DBMS_OUTPUT.PUT_LINE(' ISCRIZIONE ANCORA DISPONIBILE PER '|| POSTI_DISPONIBILI);
	INSERT INTO PERSONA VALUES(NOME_NUOVA_PERSONA,COGNOME_NUOVO_ARTISTA,SESSO,CODICE_FISCALE_NUOVO_ARTISTA,DATA_DI_NASCITA_NUOVA_PERSONA);
	INSERT INTO CANZONE VALUES(ID_CANZONE_NUOVO_ARTISTA,NULL,TITOLO_NUOVA_CANZONE,GENERE_NUOVA_CANZONE,MINUTI_NUOVA_CANZONE,SECONDI_NUOVA_CANZONE);
	INSERT INTO ARTISTA VALUES(CODICE_FISCALE_NUOVO_ARTISTA,ID_CANZONE_NUOVO_ARTISTA,PASS_NUOVO_ARTISTA);
                      
                            IF (E_SOLISTA>0) THEN INSERT INTO SOLISTA VALUES(CODICE_FISCALE_NUOVO_ARTISTA,GENERE_NUOVA_CANZONE,NUOVO_MUSICISTA,TIPO_STRUMENTO);       		    
                           ELSE IF(E_BAND>0) THEN INSERT INTO BAND VALUES(CODICE_FISCALE_NUOVO_ARTISTA,NOME_BAND,GENERE_NUOVA_CANZONE,NUMERO_COMPONENTI);
                  		    END IF;
END IF;
               		


ELSE RAISE ERRORE;
END IF;


COMMIT;
ROLLBACK;

EXCEPTION
WHEN ERRORE THEN
RAISE_APPLICATION_ERROR(-20119, 'ERRORE LA PROCEDURA DI INSERIMENTO DI UN NUOVO ARTISTA NON E AVVENUTA CON SUCCESSO POICHE I POSTI SONO ESAURITI');
END ISCRIZIONE_ARTISTA;
/